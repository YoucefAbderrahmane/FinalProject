/*
 * aures.cpp
 *
 *  Created on: 12 juil. 2016
 *      Author: root
 */

#include "aures.h"

namespace pagmo {
namespace problem {

double addSecondsToJD(double JD, double seconds){

	//convert JD to date
	time_t * d = new time_t();
	ln_get_timet_from_julian(JD, d);

	//Add seconds to d
	struct tm d_tm = *localtime(d);
	d_tm.tm_sec += seconds;

	//normalize tm and convert it to time_t
	time_t new_d = mktime(&d_tm);

	//return the equivalent julian day
	return ln_get_julian_from_timet (&new_d);
}

aures::aures(std::vector<Observation> observations, int observation_length, int teles_length) :
		base(observations_length*teles_length), observations_length(observation_length),
		teles_length(teles_length), night_horizon(), bounds(), total_duration()
{

	night_horizon.start = observations.at(0).getConditions()->getNightHorizon().start;
	night_horizon.end = observations.at(0).getConditions()->getNightHorizon().end;

	bounds.start = addSecondsToJD(night_horizon.start, -7200.0);
	bounds.end = addSecondsToJD(night_horizon.end, 7200.0);

	set_lb(bounds.start);
	set_ub(bounds.end);
}

aures::~aures() {
	// TODO Auto-generated destructor stub
}

base_ptr aures::clone() const {

	return base_ptr(new aures(*this));
}

void aures::objfun_impl(fitness_vector& f,
		const decision_vector& x) const {

	f[0] = 0.0; //f[0] : number of scheduled observations (maximize this value)
	f[1] = 0.0; //f[1] : Average of altitude merits of all observed targets (maximize)
	f[2] = 0.0; //f[2] : Average of telescope movement during the whole schedule (minimize)
	f[3] = 0.0; //f[3] : number of telescopes using for scheduling (minimize)
}

void aures::compute_constraints_impl(constraint_vector& c,
		const decision_vector& x) const {
}

int SchedulingProb::get_decv_index(int mat_i, int mat_j) const {

	if( mat_i > 0) return mat_i*observations_length + mat_j;
	else return mat_j;
}

void SchedulingProb::get_mat_index(int& mat_i, int& mat_j, int dec_ind) {

	mat_j = dec_ind % observations_length;
	mat_i = (dec_ind - mat_j) / observations_length;
}

} /* namespace  problem */
} /* namespace  pagmo */
